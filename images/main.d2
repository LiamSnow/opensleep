direction: down

original: {
  cloud1: Eight Sleep Cloud {
    shape: cloud
    style.fill: "#e3f2fd"
    style.font-size: 20
  }

  app1: Mobile App {
    shape: rectangle
    style.fill: "#fff3e0"
    style.font-size: 18
  }

  main_unit1: Pod {
    style.fill: "#f5f5f5"
    style.stroke-width: 3
    style.font-size: 22
    
    som1: "Main Computer (SOM)" {
      style.fill: "#e8eaf6"
      style.font-size: 18
      
      dac1: "DAC\n(Receives commands)" {
        style.fill: "#c8e6c9"
      }
      
      frank1: "Frank\n(Controls everything)" {
        style.fill: "#bbdefb"
      }
      
      capybara1: "Capybara\n(Setup & LEDs)" {
        style.fill: "#ffe0b2"
      }
    }
    
    frozen1: "Frozen Subsystem" {
      style.fill: "#e0f7fa"
      style.font-size: 16
      
      water1: "Water Control" {
        shape: text
        style.font-size: 14
        label: |md
        - Heating/cooling (TECs)
        - 2x Water pumps
        - Tank management
        |
      }
    }
  }

  mattress1: "Mattress Cover" {
    style.fill: "#fce4ec"
    style.stroke-width: 3
    style.font-size: 22
    
    sensor1: "Sensor Unit/Subsystem" {
      style.fill: "#f8bbd0"
      style.font-size: 16
      
      sensors1: "Sensors" {
        shape: text
        style.font-size: 14
        label: |md
        - 8 temperature
        - 6 capacitance
        - 2 piezoelectric
        - Vibration motors
        |
      }
    }
  }

  app1 <-> cloud1: "Settings &\nSleep data"
  cloud1 -> main_unit1.som1.dac1: "Commands"
  main_unit1.som1.frank1 -> cloud1: "Sensor data"
  main_unit1.som1.dac1 -> main_unit1.som1.frank1: "Unix Socket"
  main_unit1.som1.frank1 <-> main_unit1.frozen1: "Temperature\ncontrol"
  main_unit1.som1.frank1 <-> mattress1.sensor1: "Sensor data &\nalarm control"
  main_unit1 -- mattress1: "USB Cable"
}

ninesleep: {
  lan2: LAN {
    style.fill: "#e3f2fd"
    style.font-size: 20
  }

  cloud2: Eight Sleep Cloud {
    shape: cloud
    style.fill: "#e3f2fd"
    style.font-size: 20
  }

  main_unit2: Pod {
    style.fill: "#f5f5f5"
    style.stroke-width: 3
    style.font-size: 22
    
    som2: "Main Computer (SOM)" {
      style.fill: "#e8eaf6"
      style.font-size: 18
      
      ninesleep2: "ninesleep" {
        style.fill: "#c8e6c9"
      }
      
      frank2: "Frank\n(Controls everything)" {
        style.fill: "#bbdefb"
      }
      
      capybara2: "Capybara\n(Setup & LEDs)" {
        style.fill: "#ffe0b2"
      }
    }
    
    frozen2: "Frozen Subsystem" {
      style.fill: "#e0f7fa"
      style.font-size: 16
      
      water2: "Water Control" {
        shape: text
        style.font-size: 14
        label: |md
        - Heating/cooling (TECs)
        - 2x Water pumps
        - Tank management
        |
      }
    }
  }

  mattress2: "Mattress Cover" {
    style.fill: "#fce4ec"
    style.stroke-width: 3
    style.font-size: 22
    
    sensor2: "Sensor Unit/Subsystem" {
      style.fill: "#f8bbd0"
      style.font-size: 16
      
      sensors2: "Sensors" {
        shape: text
        style.font-size: 14
        label: |md
        - 8 temperature
        - 6 capacitance
        - 2 piezoelectric
        - Vibration motors
        |
      }
    }
  }

  lan2 -> main_unit2.som2.ninesleep2: "Commands"
  main_unit2.som2.frank2 -> cloud2: "Sensor data"
  main_unit2.som2.ninesleep2 -> main_unit2.som2.frank2: "Unix Socket"
  main_unit2.som2.frank2 <-> main_unit2.frozen2: "Temperature\ncontrol"
  main_unit2.som2.frank2 <-> mattress2.sensor2: "Sensor data &\nalarm control"
  main_unit2 -- mattress2: "USB Cable"
}

opensleep: {
  broker3: MQTT Broker {
    shape: rectangle
    style.fill: "#e3f2fd"
    style.font-size: 20
  }

  main_unit3: Pod {
    style.fill: "#f5f5f5"
    style.stroke-width: 3
    style.font-size: 22
    
    som3: "Main Computer (SOM)" {
      style.fill: "#e8eaf6"
      style.font-size: 18
      
      opensleep3: "opensleep" {
        style.fill: "#bbdefb"
      }
    }
    
    frozen3: "Frozen Subsystem" {
      style.fill: "#e0f7fa"
      style.font-size: 16
      
      water3: "Water Control" {
        shape: text
        style.font-size: 14
        label: |md
        - Heating/cooling (TECs)
        - 2x Water pumps
        - Tank management
        |
      }
    }
  }

  mattress3: "Mattress Cover" {
    style.fill: "#fce4ec"
    style.stroke-width: 3
    style.font-size: 22
    
    sensor3: "Sensor Unit/Subsystem" {
      style.fill: "#f8bbd0"
      style.font-size: 16
      
      sensors3: "Sensors" {
        shape: text
        style.font-size: 14
        label: |md
        - 8 temperature
        - 6 capacitance
        - 2 piezoelectric
        - Vibration motors
        |
      }
    }
  }

  broker3 -> main_unit3.som3.opensleep3: "Config"
  main_unit3.som3.opensleep3 -> broker3: "Status"
  main_unit3.som3.opensleep3 <-> main_unit3.frozen3: "Temperature\ncontrol"
  main_unit3.som3.opensleep3 <-> mattress3.sensor3: "Sensor data &\nalarm control"
  main_unit3 -- mattress3: "USB Cable"
}
